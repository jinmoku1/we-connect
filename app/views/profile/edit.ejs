<%- include ../partials/header.ejs %>

<div style="width: 560px; margin:auto;">
	<h1><%=title%></h1>
	
	<ul class="nav nav-tabs ">
		<li class="active"><a href="#profile" data-toggle="tab">Profile</a></li>
		<li><a href="#addtionalInfo" data-toggle="tab">Additional Information</a></li>
		<li><a href="#privacy" data-toggle="tab">Privacy Setting</a></li>
	</ul>
	
	<div class="tab-content">
		<% if (error) { %>
		<p class="error">
			<%= error %>
		</p>
		<% } %>
		<div class="tab-pane active" id="profile">
			<form id="editForm" class="form-horizontal" method="post" action="/setting/profile">
				<div class="form-group">
					<label class="col-sm-3 control-label" for="firstName">First Name</label>
					<div class="col-sm-9">
						<input type="text" id="firstName" value="<%=user.firstName%>" placeholder="First Name" name="firstName" class="form-control" required />
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-3 control-label" for="lastName">Last Name</label>
					<div class="col-sm-9">
						<input type="text" id="lastName" value="<%=user.lastName%>" placeholder="Last Name" name="lastName" class="form-control" required />
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-3 control-label">Department</label>
					<div class="col-sm-9">
						<select id="department" value="<%=user.departments%>" class="form-control" name="department" required>
						<% for (var i in departments) { 
							if (user.department == departments[i]){
							%>
							<option value="<%=departments[i]%>" selected><%=departments[i]%></option>
							<%
						} else{ %>
							<option value="<%=departments[i]%>"><%=departments[i]%></option>
						<% } }%>
						</select>
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-3 control-label">Interests</label>
					<div class="col-sm-9">
					<% for (var i in interests) { %>
						<div class="checkbox col-sm-6">
							<label>
								<%
								var exists = 0;
								for (var j in user.interests){
									if (user.interests[j] == interests[i]){
										exists = 1;
										break;
									}
								}
								if (exists){ %>
									<input type="checkbox" name="interests" value="<%=interests[i]%>" checked="checked"/>
									<%=interests[i]%>
								<% } else { %>
									<input type="checkbox" name="interests" value="<%=interests[i]%>" />
									<%=interests[i]%>
								<% } %>
							</label>
						</div>
					<% } %>
					</div>
				</div>
				<% if (user.userType == userConst.TYPE_STUDENT) { %>
					<div class="form-group">
						<label class="col-sm-3 control-label">Degree</label>
						<div class="col-sm-9">
							<select id="degree" class="form-control" name="degree" required>
							<% for (var i in degrees) { 
								if (user.extension.degree == degrees[i]){
								%>
								<option value="<%=degrees[i]%>" selected><%=degrees[i]%></option>
								<%
							} else{ %>
								<option value="<%=degrees[i]%>"><%=degrees[i]%></option>
							<% } }%>
						</select>
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-3 control-label">Standing</label>
						<div class="col-sm-9">
							<select id="classStanding" class="form-control" name="classStanding" required>
							<% for (var i in classStandings) { 
								if (user.extension.classStanding == classStandings[i]){
								%>
								<option value="<%=classStandings[i]%>" selected><%=classStandings[i]%></option>
								<%
							} else{ %>
								<option value="<%=classStandings[i]%>"><%=classStandings[i]%></option>
							<% } }%>
							</select>
						</div>
					</div>
				<% } else if (user.userType == userConst.TYPE_FACULTY) { %>
					<div class="form-group">
						<label class="col-sm-3 control-label" for="websiteUrl">Website</label>
						<div class="col-sm-9">
							<input type="url" id="websiteUrl" value="<%=user.extension.websiteUrl%>" name="websiteUrl" class="form-control" />
						</div>
					</div>
				<% } %>
				<div class="form-group">
					<div class="col-sm-offset-3 col-sm-9">
						<button type="submit" class="btn btn-primary">Update Profile</button>
					</div>
				</div>
			</form>
		</div>
		
		<!-- Additional Info -->
		<div class="tab-pane" id="addtionalInfo">
			<form id="additionalInfoForm" class="form-horizontal" method="post" action="/setting/additionalInfo">
				<div class="form-group">
					<label class="col-sm-3 control-label" for="intro">Introduction</label>
					<div class="col-sm-offset-3 col-sm-9">
						<textarea rows="5" cols="50" id="intro" name="intro"><% if (user.intro){ %><%=user.intro%><% } %></textarea>
					</div>
				</div>

				<% if (user.userType == userConst.TYPE_STUDENT) { %>
				<div class="form-group">
					<label class="col-sm-3 control-label" for="overallGPA">Overall GPA</label>
					<div class="col-sm-9">
						<input type="number" id="overallGPA" value="<%=user.extension.overallGPA%>" placeholder="overall GPA" name="overallGPA" class="form-control" />
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-3 control-label" for="technicalGPA">Technical GPA</label>
					<div class="col-sm-9">
						<input type="number" id="technicalGPA" value="<%=user.extension.technicalGPA%>" placeholder="technical GPA" name="technicalGPA" class="form-control" />
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-3 control-label">Courses Taken</label>
					<div class="col-sm-9">
					<% for (var i in courses) { %>
						<div class="checkbox col-sm-6">
							<label>
								<%
								var exists = 0;
								for (var j in user.extension.coursesTaken){
									if (user.extension.coursesTaken[j] == courses[i]){
										exists = 1;
										break;
									}
								}
								if (exists){ %>
									<input type="checkbox" name="coursesTaken" value="<%=courses[i]%>" checked="checked"/>
									<%=courses[i]%>
								<% } else { %>
									<input type="checkbox" name="coursesTaken" value="<%=courses[i]%>" />
									<%=courses[i]%>
								<% } %>
							</label>
						</div>
					<% } %>
					</div>
				</div>
				<% } else if (user.userType == userConst.TYPE_FACULTY) { %>
				<div class="form-group">
					<label class="col-sm-3 control-label">Courses Taught</label>
					<div class="col-sm-9">
					<% for (var i in courses) { %>
						<div class="checkbox col-sm-6">
							<label>
								<%
								var exists = 0;
								for (var j in user.extension.coursesTaught){
									if (user.extension.coursesTaught[j] == courses[i]){
										exists = 1;
										break;
									}
								}
								if (exists){ %>
									<input type="checkbox" name="coursesTaught" value="<%=courses[i]%>" checked="checked"/>
									<%=courses[i]%>
								<% } else { %>
									<input type="checkbox" name="coursesTaught" value="<%=courses[i]%>" />
									<%=courses[i]%>
								<% } %>
							</label>
						</div>
					<% } %>
					</div>
				</div>
				<% } %>
				<div class="form-group">
					<div class="col-sm-offset-3 col-sm-9">
						<button type="submit" class="btn btn-primary">Update Addtional Info</button>
					</div>
				</div>
			</form>
		</div>
		
		<!-- Change Password -->
		<div class="tab-pane" id="privacy">
			<form id="changePasswordForm" class="form-horizontal" method="post" action="/setting/changePW">
				<div class="form-group">
					<label class="col-sm-3 control-label" for="oldPassword">Old Password</label>
					<div class="col-sm-9">
						<input type="password" id="oldPassword" placeholder="Old Password" name="oldPassword" class="form-control" required />
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-3 control-label" for="newPassword">New Password</label>
					<div class="col-sm-9">
						<input type="password" id="newPassword" placeholder="New Password" name="newPassword" class="form-control" required />
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-3 control-label" for="confirmNewPassword">Confirm New Password</label>
					<div class="col-sm-9">
						<input type="password" id="confirmNewPassword" placeholder="Confirm New Password" name="confirmNewPassword" class="form-control" required />
					</div>
				</div>
				<div class="form-group">
					<div class="col-sm-offset-3 col-sm-9">
						<button type="submit" class="btn btn-primary">Update Password</button>
					</div>
				</div>
			</form>
		</div>
	</div>

	
</div>

<script>

jQuery.validator.addMethod("isValidNetId", 
	function(value, element) {
    	return /\b[a-zA-Z]+[0-9]+\b/.test(value);
    },
    jQuery.validator.format("Please enter a valid netID.")
);

jQuery.validator.addMethod("isValidName", 
	function(value, element) {
    	return /\b[a-zA-Z]+\b/.test(value);
    },
    jQuery.validator.format("Only alphabets are allowed for names.")
);
		
$('#editForm').validate({
	rules: {
		firstName: {
			isValidName: true
		},
		lastName: {
			isValidName: true
		},
		confirm: {
			equalTo: "#password"
		}
	},
	errorClass: "validate-error",
	messages: {
		remote: jQuery.validator.format("{0} is already taken.")
	}
});

$('#changePasswordForm').validate({
	rules: {
		newPassword: {
			minlength: 8,
			maxlength: 20
		},
		confirmNewPassword: {
			equalTo: "#newPassword"
		}
	},
	errorClass: "validate-error"
});
</script>

<%- include ../partials/footer.ejs %>