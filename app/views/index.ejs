<%- include partials/header.ejs %>

<div class="col-sm-10 col-sm-offset-1">
	<div id="topContainer" class="row">
		<div id="pictureContainer" class="col-md-3">
			<div class="picture">
			<% if (user.profilePicUrl != null) { %>
				<img src="<%=user.profilePicUrl%>" />
			<% } %>
			</div>
		</div>
		<div id="profileContainer" class="col-md-9">
			<h1 class="name">
				<%=user.firstName%>
				<%=user.lastName%>
				<span class="email">
					<em><a href="mailto:<%=user.netId%>@illinois.edu"><%=user.netId%>@illinois.edu</a></em>
				</span>
			</h1>
			<p>
				<% if (user.userType == userConst.TYPE_STUDENT) { %>
					<em><%=user.extension.degree%> (<%=user.extension.classStanding%>) in <%=user.department%></em>
				<% } else {%>
					<em>Faculty in <%=user.department%></em>
				<% } %>
			</p>
			<p class="intro">
				<%=user.intro%>...
				<a data-toggle="modal" data-target="#fullIntroModal"><em>more</em></a>
			</p>
			<p class="interests">
				<% for (var i in user.interests) { %>
				<span class="label label-default"><%=user.interests[i]%></span>
				<% } %>
			</p>
			<div class="buttons">
				<a class="btn btn-lgray" data-toggle="modal" href="/embedded/followees" data-target="#followeesModal">
					Followees <span id="followeeCount" class="badge"><%=user.followees.length%></span>
				</a>
				<a class="btn btn-lgray" data-toggle="modal" href="/embedded/followings" data-target="#followingsModal">
					Followings <span class="badge"><%=user.followings.length%></span>
				</a>
			</div>
		</div>
	</div>

	<div id="bottomContainer" class="row">
		<div id="mainContainer" class="col-md-9">
			<ul class="nav nav-tabs">
				<li class="active"><a href="#anncRecList" data-toggle="tab">Announcements</a></li>
				<li><a href="#anncFollowingList" data-toggle="tab">Followings</a></li>
				<li><a href="#archive" data-toggle="tab">Archive</a></li>
				<li><a href="#anncMyList" data-toggle="tab">My Announcements</a></li>
				<li><a href="#anncBookmarked" data-toggle="tab">Bookmarks</a></li>
			</ul>
			<div class="tab-content">
				<div class="tab-pane active" id="anncRecList">
				</div>
				<div class="tab-pane" id="anncFollowingList">
				</div>
				<div class="tab-pane" id="archive">
					<div class="anncList">
						<%  
						for (var i in anncBriefs) { %>
						<div class="row">
							<div class="col-md-2">
								<img src="<%=anncBriefs[i].author.profilePic%>" />
							</div>
							<div class="col-md-7">
								<h1 class="title">
									<a href="announcement/<%=anncBriefs[i].detailId%>"><%=anncBriefs[i].title%></a>
									<span class="author">
										<em><%=anncBriefs[i].author.name%></em>
									</span>
								</h1>
								<p class="contentBrief">
									<%=anncBriefs[i].contentBrief%>...
									<span class="timeStamp">
										<em>
										<% var date = anncBriefs[i].timeStamp; %>
										<%=""+date.getDate()+"/"
											+(date.getMonth()+1)+"/"
											+date.getFullYear()+" @ "
											+date.getHours()+":"
											+date.getMinutes()+":" 
											+date.getSeconds()
										%>
										</em>
									</span>
								</p>
								<p class="anncTypes">
									<%
									for (var j in anncBriefs[i].anncTypes) { %>
									<span class="label label-default"><%=anncBriefs[i].anncTypes[j]%></span>
									<% } %>
								</p>
							</div>
						</div>
						<% } %>
					</div>
				</div>
				<div class="tab-pane" id="anncMyList">
				</div>
				<div class="tab-pane" id="anncBookmarked">
					<div class="anncList">
						<%  
						for (var i in user.bookmarkedAnncs) { %>
						<div class="row">
							<div class="col-md-2">
								<img src="<%=user.bookmarkedAnncs[i].author.profilePic%>" />
							</div>
							<div class="col-md-7">
								<h1 class="title">
									<a href="announcement/<%=user.bookmarkedAnncs[i].detailId%>"><%=user.bookmarkedAnncs[i].title%></a>
									<span class="author">
										<em><%=user.bookmarkedAnncs[i].author.name%></em>
									</span>
								</h1>
								<p class="contentBrief">
									<%=user.bookmarkedAnncs[i].contentBrief%>...
									<span class="timeStamp">
										<em>
										<%=user.bookmarkedAnncs[i].timeStamp %>
										</em>
									</span>
								</p>
								<p class="anncTypes">
									<%
									for (var j in user.bookmarkedAnncs[i].anncTypes) { %>
									<span class="label label-default"><%=user.bookmarkedAnncs[i].anncTypes[j]%></span>
									<% } %>
								</p>
							</div>
						</div>
						<% } %>
					</div>
				</div>
			</div>
		</div>
		<div id="sideContainer" class="col-md-3">
			<h3 class="header-side">Suggested Users</h3>
			<% for (var i in userBriefs) { %>
				<div class="user" id="<%=userBriefs[i].detailId%>">
					<div class="top row">
						<div class="col-md-4">
							<div class="picture">
							<% if (userBriefs[i].profilePicUrl != null) { %>
								<img src="<%=userBriefs[i].profilePicUrl%>" />
							<% } %>
							</div>
						</div>
						<div class="side col-md-8">
							<p class="name">
								<a data-toggle="modal" href="/embedded/profile/<%=userBriefs[i].detailId%>" data-target="#userProfileModal">
									<%=userBriefs[i].firstName%></br /><%=userBriefs[i].lastName%>
								</a>
							</p>
							<div class="email">
								<a href="mailto:<%=userBriefs[i].netId%>@illinois.edu">
									<em><%=userBriefs[i].netId%>@illinois.edu</a>
								</em>
							</div>
						</div>
					</div>
					<div class="interests">
						<span class="label label-info">Software Engineering</span>
						<span class="label label-info">Data Mining</span>
						<span class="label label-info">Computer Architecture</span>
						<span class="label label-info">Database</span>
					</div>
				</div>
			<% } %>
		</div>
	</div>
</div>
<!-- Full Intro Modal -->
<div class="modal fade" id="fullIntroModal" tabindex="-1" role="dialog" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h4 class="modal-title" id="myModalLabel">Introduction</h4>
			</div>
			<div class="modal-body">
				<p><%=user.intro%></p> 
			</div>
		</div>
	</div>
</div>

<!-- User Profile Modal -->
<div class="modal fade" id="userProfileModal" tabindex="-1" role="dialog" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
		</div>
	</div>
</div>

<!-- Followees Modal -->
<div class="modal fade" id="followeesModal" tabindex="-1" role="dialog" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
		</div>
	</div>
</div>

<!-- Followings Modal -->
<div class="modal fade" id="followingsModal" tabindex="-1" role="dialog" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
		</div>
	</div>
</div>

<!-- User Followee list modal -->
<div class="modal fade" id="userFolloweeListModal" tabindex="-1" role="dialog" aria-labelledby="userFolloweeListModal" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
		</div>
	</div>
</div>

<script>
function onToggleFollow(targetId) {
	$.post('/api/follow', { id : targetId }, function(sessionUser) {
		$('#followeeCount').html(sessionUser.followees.length);
		$('#' + targetId).fadeOut('fast');
		$('.modal').modal('hide');
	});
}

$('a[data-toggle=modal]').click(function(event) {
	event.preventDefault();
	var url = $(this).attr('href');
	var target = $(this).data('target');
	// load the url and show modal on success
	$(target + ' .modal-content').load(url, function() { 
		$(target).modal('show');
	});
});
</script>

<%- include partials/footer.ejs %>